#### spi note

1. 通信方式

   高速、同步、串行、全双工。

2. 应用

   EEPROM，FLASH，实时时钟，AD转换器，数字信号处理和数字信号解码器等硬件。

3. SPI 总线物理结构

4. SPI 总线拓扑结构

5. SPI 总线速率：MB

6. SPI 以主从方式工作，通常有一个主设备和一个或多个从设备。通信由主设备发起，主设备通过 CS 选择要通信的从设备，然后通过 SCLK 给从设备提供时钟信号，数据通过 MOSI 输出给从设备，<u>同时</u>通过 MISO 接收从设备发送的数据。

   - Note：
     - SPI 总线数据格式不固定：数据长度不固定，可以变化。SPI总线支持暂停功能。
     - 每发送一位数据必然接受一位数据。

7. SPI 控制器对应 SPI 主设备。任何时刻，一个 SPI 主设备上只有一个 CS 引脚处于有效状态，与该有效 CS 引脚连接的从设备此时可以与主设备通信。

8. 从设备的时钟由主设备通过 SCLK 提供，MOSI、MISO 则基于此脉冲完成数据传输。

9. <u>SPI 的工作时序模式由 CPOL（Clock Polarity，时钟极性）和 CPHA（Clock Phase，时钟相位）之间的相位关系决定，CPOL 表示时钟信号的初始电平的状态</u>，CPOL 为 0 表示时钟信号初始状态为低电平，为 1 表示时钟信号的初始电平是高电平。<u>CPHA 表示在哪个时钟沿采样数据</u>，CPHA 为 0 表示在首个时钟变化沿采样数据，而 CPHA 为 1 则表示在第二个时钟变化沿采样数据。根据 CPOL 和 CPHA 的不同组合共有 4 种工作时序模式：

   - ①CPOL=0，CPHA=0
   - ②CPOL=0，CPHA=1
   - ③CPOL=1，CPHA=0
   - ④CPOL=1，CPHA=1
     - Note：
       - 哪个边沿发送数据，哪个边沿准备数据，总线空闲时时钟线的状态。
       - 四要素：上升沿、下降沿、前沿、后沿。

9. QSPI：QSPI 是 Queued SPI 的简写。

   - 增加了队列传输机制，推出了队列串行外围接口协议（即 QSPI 协议）。
   - 使用该接口，用户可以一次性传输包含多达 16 个 8 位或 16 位数据的传输队列。<u>一旦传输启动，直到传输结束，都不需要 CPU 干预</u>，极大的提高了传输效率。
   - 与 SPI 相比，<u>QSPI 的最大结构特点是以 80 字节的 RAM 代替了 SPI 的发送和接收数据寄存器</u>。

10. SPI Flash：

    - 标准 SPI Flash。

    - Dual SPI Flash：
      - 工作在半双工模式，用以加倍数据传输。
      - MOSI 变成 SIO0（serial io 0），MISO 变成 SIO1（serial io 1）,这样一个时钟周期内就能传输 2 个 bit 数据，加倍了数据传输。
    - Quad SPI Flash：Quad SPI Flash增加了两根 I/O 线（SIO2,SIO3），目的是一个时钟内传输 4 个 bit 数据。

11. W25Q128：

    - 容量：16M byte。
    - 16M 容量分为 256 块，每块大小为 64K 字节，每块有分别为 16 个扇区，每个扇区 4K 字节，<u>（每页 256 个字节）</u>。